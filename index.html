<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>PapadSale - Gujarati Swad, Ghar-ghar Tak!</title>
  <meta name="description" content="Fresh homemade Gujarati snacks delivered to your doorstep. Order authentic papad, mathiya, khakhra and more with free delivery." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    body{box-sizing:border-box}
    .font-baloo{font-family:"Baloo 2",cursive}
    .font-inter{font-family:"Inter",sans-serif}
    .bg-cream{background:#FEF7ED}
    .bg-saffron{background:#FF6A00}
    .text-saffron{color:#FF6A00}
    .gujarati-pattern{background-image:radial-gradient(circle at 25px 25px,rgba(255,106,0,.08) 2px,transparent 2px),radial-gradient(circle at 75px 75px,rgba(255,140,0,.06) 2px,transparent 2px);background-size:100px 100px,150px 150px}
    .soft-shadow{box-shadow:0 8px 32px rgba(255,106,0,.12)}
    .product-card{transition:.3s}
    .product-card:hover{transform:translateY(-4px);box-shadow:0 16px 48px rgba(255,106,0,.2)}
    .weight-toggle{transition:.2s}
    .weight-toggle.active{background:#FF6A00;color:#fff;border-color:#FF6A00;transform:scale(1.02)}
    .cart-drawer{transform:translateX(100%);transition:transform .3s ease-in-out}
    .cart-drawer.open{transform:translateX(0)}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000}
    .modal.show{display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body class="bg-cream font-inter">

  <!-- HEADER (unchanged) -->
  <header class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center overflow-hidden">
            <img src="assets/logo.png" alt="PapadSale Logo" class="w-8 h-8 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
            <span class="text-saffron font-bold text-lg hidden">P</span>
          </div>
          <div>
            <h1 class="font-baloo font-bold text-xl text-saffron">PapadSale</h1>
            <p class="text-xs text-gray-600">Gujarati Swad, Ghar-ghar Tak!</p>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <button onclick="toggleCart()" class="relative bg-saffron text-white px-4 py-2 rounded-lg font-semibold hover:bg-orange-600">ğŸ›’ àª•àª¾àª°à«àªŸ
            <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </button>
          <div class="text-right">
            <p class="text-sm text-gray-600">àª•à«àª²</p>
            <p id="cart-total-header" class="font-bold text-saffron">â‚¹0</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO (unchanged) -->
  <section class="gujarati-pattern py-16">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <h2 class="font-baloo font-bold text-4xl md:text-6xl text-saffron mb-4">àª¸à«àªµàª¾àª¦àª¿àª·à«àªŸ àª—à«àªœàª°àª¾àª¤à«€ àª¨àª¾àª¸à«àª¤à«‹</h2>
      <p class="text-lg md:text-xl text-gray-700 mb-8 max-w-2xl mx-auto">Fresh homemade Gujarati snacks delivered to your doorstep. Experience authentic flavors with every bite!</p>
      <div class="flex flex-wrap justify-center gap-4">
        <div class="bg-white px-6 py-3 rounded-full soft-shadow"><span class="text-2xl">ğŸ </span><span class="ml-2 font-semibold">Homemade Quality</span></div>
        <div class="bg-white px-6 py-3 rounded-full soft-shadow"><span class="text-2xl">ğŸšš</span><span class="ml-2 font-semibold">Free Delivery</span></div>
        <div class="bg-white px-6 py-3 rounded-full soft-shadow"><span class="text-2xl">â­</span><span class="ml-2 font-semibold">Premium Quality</span></div>
      </div>
    </div>
  </section>

  <!-- CATEGORY FILTERS (unchanged) -->
  <section class="py-8 bg-white">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex flex-wrap justify-center gap-4">
        <button onclick="filterProducts('all')" class="filter-btn bg-saffron text-white px-6 py-2 rounded-full font-semibold">àª¬àª§à«àª‚</button>
        <button onclick="filterProducts('papad')" class="filter-btn bg-white text-gray-700 px-6 py-2 rounded-full border">àªªàª¾àªªàª¡</button>
        <button onclick="filterProducts('mathiya')" class="filter-btn bg-white text-gray-700 px-6 py-2 rounded-full border">àª®àª àª¿àª¯àª¾</button>
        <button onclick="filterProducts('khakhra')" class="filter-btn bg-white text-gray-700 px-6 py-2 rounded-full border">àª–àª¾àª–àª°àª¾</button>
        <button onclick="filterProducts('snacks')" class="filter-btn bg-white text-gray-700 px-6 py-2 rounded-full border">àª¨àª¾àª¸à«àª¤à«‹</button>
        <button onclick="filterProducts('sweets')" class="filter-btn bg-white text-gray-700 px-6 py-2 rounded-full border">àª®àª¿àª àª¾àªˆ</button>
      </div>
    </div>
  </section>

  <!-- PRODUCTS -->
  <section class="py-16">
    <div class="max-w-6xl mx-auto px-4">
      <div class="text-center mb-12">
        <h3 class="font-baloo font-bold text-3xl text-gray-800 mb-4">àª…àª®àª¾àª°àª¾ àªªà«àª°à«‹àª¡àª•à«àªŸà«àª¸</h3>
        <p class="text-gray-600">Fresh, authentic Gujarati snacks made with love</p>
      </div>
      <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- CONTACT (unchanged content) -->
  <section class="py-16 bg-white">
    <div class="max-w-6xl mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <h3 class="font-baloo font-bold text-3xl text-gray-800 mb-4">àª¸àª‚àªªàª°à«àª• àª•àª°à«‹</h3>
          <p class="text-gray-600">Get in touch with us for orders and inquiries</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="space-y-6">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-saffron rounded-full flex items-center justify-center"><span class="text-white text-xl">ğŸ“±</span></div>
              <div><h4 class="font-semibold">WhatsApp</h4><p class="text-gray-600">+91 99781 13276</p></div>
            </div>
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-saffron rounded-full flex items-center justify-center"><span class="text-white text-xl">ğŸ“§</span></div>
              <div><h4 class="font-semibold">Email</h4><p class="text-gray-600">info@papadsale.com</p></div>
            </div>
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-saffron rounded-full flex items-center justify-center"><span class="text-white text-xl">ğŸ“</span></div>
              <div><h4 class="font-semibold">Location</h4><p class="text-gray-600">Ahmedabad, Gujarat, India</p></div>
            </div>
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-saffron rounded-full flex items-center justify-center"><span class="text-white text-xl">ğŸ•’</span></div>
              <div><h4 class="font-semibold">Working Hours</h4><p class="text-gray-600">Mon - Sat: 9 AM - 8 PM</p></div>
            </div>
          </div>
          <div class="bg-gray-50 p-6 rounded-2xl">
            <h4 class="font-semibold text-lg mb-4">Send us a message</h4>
            <form onsubmit="sendMessage(event)" class="space-y-4">
              <input type="text" placeholder="Your Name" required class="w-full p-3 border rounded-lg focus:border-saffron outline-none" />
              <input type="tel" placeholder="Phone Number" required class="w-full p-3 border rounded-lg focus:border-saffron outline-none" />
              <textarea placeholder="Your Message" rows="4" required class="w-full p-3 border rounded-lg focus:border-saffron outline-none resize-none"></textarea>
              <button type="submit" class="w-full bg-saffron text-white py-3 rounded-lg font-semibold hover:bg-orange-600">Send Message</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CART DRAWER -->
  <div id="cart-drawer" class="cart-drawer fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl z-50 overflow-y-auto">
    <div class="p-4 md:p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl md:text-2xl font-baloo font-bold text-gray-800">Your Cart</h3>
        <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>

      <div id="cart-items" class="space-y-4 mb-6">
        <p class="text-gray-500 text-center py-8">Your cart is empty</p>
      </div>

      <!-- Upsells (kept) -->
      <div id="upsell-section" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">You may also like</h4>
        <div id="upsell-items" class="space-y-3"></div>
      </div>

      <div id="cart-total-block" class="border-t pt-4 mb-6 hidden">
        <div class="flex justify-between items-center text-lg font-bold">
          <span>Total:</span><span id="total-amount">â‚¹0</span>
        </div>
      </div>

      <!-- CHECKOUT (updated per request) -->
      <div id="checkout-form" class="hidden">
        <h4 class="text-lg font-baloo font-bold mb-4">Delivery Details</h4>
        <div class="space-y-4">
          <input id="customer-name" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" placeholder="Full Name *" required />
          <input id="customer-mobile" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" placeholder="Mobile Number (WhatsApp) *" pattern="[0-9]{10}" required />
          <textarea id="customer-address" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" rows="3" placeholder="Full Address *" required></textarea>
          <input id="customer-pincode" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" placeholder="Pincode *" pattern="[0-9]{6}" required />
          <input id="customer-landmark" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" placeholder="Landmark (Optional)" />
          <textarea id="order-notes" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-saffron" rows="2" placeholder="Notes (Optional)"></textarea>
          <!-- Removed COD as requested -->
          <div class="p-3 rounded-lg bg-yellow-50 border border-yellow-200">
            <p class="font-semibold mb-2">Payment Method: <span class="text-saffron">UPI Only</span></p>
            <p class="text-sm text-gray-600">Scan and pay, then upload the screenshot below to confirm.</p>
          </div>
        </div>

        <div class="space-y-3 mt-6">
          <button onclick="updateCart()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg">ğŸ›’ Update Cart (Add More Items)</button>
          <a id="payUPI" href="upi://pay?pa=9978113276@okbizaxis&pn=Papadsale&cu=INR" target="_blank" class="block text-center w-full bg-saffron hover:bg-orange-600 text-white py-3 rounded-lg font-semibold">ğŸ’³ Pay via UPI</a>
        </div>

        <!-- Payment QR + Screenshot Upload FIRST -->
        <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200 text-center">
          <h5 class="font-bold text-gray-800 mb-3">ğŸ’³ Pay Papadsale via UPI</h5>
          <!-- Your QR is shown from assets/qr.png -->
          <img src="assets/qr.png" alt="UPI QR Code" class="w-36 h-36 mx-auto rounded-lg border mb-3" />
          <p class="text-sm text-gray-600 mb-3">Scan, pay and upload the payment screenshot below.</p>
          <input id="payment-screenshot" type="file" accept="image/*" class="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-saffron file:text-white hover:file:bg-orange-600 mx-auto" />
          <label class="mt-3 inline-flex items-center gap-2 text-sm text-gray-700">
            <input id="send-summary-to-self" type="checkbox" class="rounded text-saffron" checked />
            <span>Send order summary to my WhatsApp</span>
          </label>
          <button id="confirmPaymentBtn" onclick="confirmPaymentAndSend()" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold disabled:opacity-60" disabled>âœ… Confirm Payment & Send on WhatsApp</button>
          <p id="upload-hint" class="text-xs text-gray-500 mt-2">Upload screenshot to enable the button.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SUCCESS MODAL (shows only AFTER confirm) -->
  <div id="success-modal" class="modal">
    <div class="bg-white p-8 rounded-2xl max-w-md mx-4 text-center">
      <div class="text-6xl mb-4">âœ…</div>
      <h3 class="font-bold text-xl mb-2">Order Placed Successfully!</h3>
      <p class="text-gray-600 mb-6">We'll contact you shortly on WhatsApp to confirm your order.</p>
      <button onclick="closeModal()" class="bg-saffron text-white px-6 py-2 rounded-lg hover:bg-orange-600">Continue Shopping</button>
    </div>
  </div>

  <!-- FLOATING WHATSAPP (unchanged) -->
  <a href="https://wa.me/919978113276" target="_blank" class="fixed bottom-5 right-5">
    <div class="bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600">ğŸ’¬</div>
  </a>

  <!-- FOOTER (unchanged layout) -->
  <footer class="bg-gray-800 text-white py-12 mt-16">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p class="text-gray-300">Â© 2024 PapadSale. All rights reserved. Made with â¤ï¸ for authentic Gujarati flavors.</p>
    </div>
  </footer>

  <!-- APP SCRIPT -->
  <script>
  /********** CONFIG **********/
  const ADMIN_WHATSAPP = '919978113276'; // your WhatsApp number (no +)
  const UPI_ID = '9978113276@okbizaxis';
  const UPI_LINK = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent('Papadsale')}&cu=INR`;
  // Optional: set to your backend endpoint that accepts a multipart image and returns {url: "https://..."}
  const ADMIN_UPLOAD_ENDPOINT = ''; // e.g., "/api/upload"

  /********** STATE **********/
  const products = [
    { id:1, name:"àª—à«àª°à«€àª¨ àªšà«€àª²à«€ àª–à«€àªšàª¿àª¯àª¾ àªªàª¾àªªàª¡", nameEn:"Green Chili Khichiya Papad", price250:90, price500:180, image:"papad1.jpg", category:"papad" },
    { id:2, name:"àª†àª¸à«àªµàª¾àª¦ àª¸àª¾àª¦àª¾ àª®àª àª¿àª¯àª¾", nameEn:"Aswad Plain Mathiya", price250:100, price500:200, image:"mathiya1.jpg", category:"mathiya" },
    { id:3, name:"àª†àª¸à«àªµàª¾àª¦ àª²à«€àª²àª¾ àª®àª°àªšàª¾ àª®àª àª¿àª¯àª¾", nameEn:"Aswad Green Chili Mathiya", price250:110, price500:220, image:"mathiya1.jpg", category:"mathiya" },
    { id:4, name:"àª†àª¸à«àªµàª¾àª¦ àªšà«‹àª³àª¾àª«àª³à«€", nameEn:"Aswad Cholafali", price250:100, price500:200, image:"chorafali1.jpg", category:"snacks" },
    { id:5, name:"àª¯àª¶ àª²à«€àª²àª¾ àª®àª°àªšàª¾ àª®àª àª¿àª¯àª¾", nameEn:"Yash Green Chili Mathiya", price250:150, price500:300, image:"combomathiyachorafali.png", category:"mathiya" },
    { id:6, name:"àª¯àª¶ àª¸àª¾àª¦àª¾ àª®àª àª¿àª¯àª¾", nameEn:"Yash Plain Mathiya", price250:140, price500:280, image:"combomathiyachorafali.png", category:"mathiya" },
    { id:7, name:"àª¯àª¶ àªšà«‹àª³àª¾àª«àª³à«€", nameEn:"Yash Cholafali", price250:140, price500:280, image:"chorafali1.jpg", category:"snacks" },
    { id:8, name:"àª®à«‡àª¥à«€ / àª®àª¸àª¾àª²àª¾ àª–àª¾àª–àª°àª¾", nameEn:"Methi / Masala Khakhra", price250:100, price500:200, image:"khakhra1.jpg", category:"khakhra" },
    { id:9, name:"àª®àª  / àªœà«àªµàª¾àª° / àª°àª¾àª—à«€ àª–àª¾àª–àª°àª¾", nameEn:"Math / Juwar / Ragi Khakhra", price250:135, price500:270, image:"khakhra1.jpg", category:"khakhra" },
    { id:10, name:"àª¬àª¿àª¸à«àª•àª¿àªŸ/àª¨àª¾àª¨àª–àªŸàª¾àªˆ", nameEn:"Biscuit/Nankhatai", price250:70, price500:140, image:"combomathiyachorafali.png", category:"sweets" },
    { id:11, name:"àª¡à«àª°àª¾àª¯ àª•àªšà«‹àª°à«€", nameEn:"Dry Kachori", price250:70, price500:140, image:"chorafali1.jpg", category:"snacks" }
  ];
  let cart = [];
  let currentFilter = 'all';
  let uploadedScreenshotFile = null; // local file reference
  let uploadedScreenshotURL = '';    // public URL if backend provided

  /********** HELPERS **********/
  const $ = (id)=>document.getElementById(id);
  function money(n){ return `â‚¹${n}`; }
  function toast(msg){
    const t=document.createElement('div');
    t.className='fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow z-50';
    t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),2200);
  }

  /********** RENDER PRODUCTS **********/
  function renderProducts(){
    const grid=$('products-grid');
    const items = currentFilter==='all' ? products : products.filter(p=>p.category===currentFilter);
    grid.innerHTML = items.map(p=>`
      <div class="product-card bg-white rounded-2xl p-6 soft-shadow">
        <div class="text-center mb-4">
          <div class="w-32 h-32 mx-auto mb-3 rounded-lg overflow-hidden bg-gray-100">
            <img src="assets/${p.image}" alt="${p.nameEn}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
            <div class="hidden w-full h-full bg-saffron text-white text-4xl items-center justify-center">ğŸ“¦</div>
          </div>
          <h3 class="font-baloo font-semibold text-lg text-gray-800 mb-1">${p.name}</h3>
          <p class="text-sm text-gray-600">${p.nameEn}</p>
        </div>
        <div class="space-y-3">
          <div class="flex justify-center gap-2">
            <button class="weight-toggle px-4 py-2 border-2 border-gray-300 rounded-lg text-sm" id="weight-250-${p.id}" onclick="selectWeight(${p.id},250)">250g - ${money(p.price250)}</button>
            <button class="weight-toggle active px-4 py-2 border-2 border-[#FF6A00] rounded-lg text-sm" id="weight-500-${p.id}" onclick="selectWeight(${p.id},500)">500g - ${money(p.price500)}</button>
          </div>
          <div class="flex items-center justify-center gap-3">
            <button class="w-8 h-8 bg-gray-200 rounded-full text-lg font-bold" onclick="qtyCh(${p.id},-1)">-</button>
            <span class="font-semibold text-lg w-8 text-center" id="qty-${p.id}">1</span>
            <button class="w-8 h-8 bg-gray-200 rounded-full text-lg font-bold" onclick="qtyCh(${p.id},1)">+</button>
          </div>
          <button class="w-full bg-saffron text-white py-3 rounded-xl font-semibold hover:bg-orange-600" onclick="addToCart(${p.id})">àª•àª¾àª°à«àªŸàª®àª¾àª‚ àª‰àª®à«‡àª°à«‹</button>
        </div>
      </div>
    `).join('');
  }
  function filterProducts(cat){
    currentFilter=cat; renderProducts();
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('bg-saffron','text-white'));
    if (event && event.target) { event.target.classList.add('bg-saffron','text-white'); }
  }
  function selectWeight(id,w){
    $('weight-250-'+id).classList.toggle('active',w===250);
    $('weight-500-'+id).classList.toggle('active',w===500);
  }
  function qtyCh(id,d){ const el=$('qty-'+id); el.textContent=Math.max(1,(parseInt(el.textContent)||1)+d); }

  /********** CART **********/
  function addToCart(id){
    const p=products.find(x=>x.id===id);
    const qty=parseInt($('qty-'+id).textContent)||1;
    const w=$('weight-500-'+id).classList.contains('active')?500:250;
    const price = w===500?p.price500:p.price250;
    const existing = cart.find(i=>i.id===id && i.weight===w);
    if (existing) existing.quantity+=qty; else cart.push({id:p.id,name:p.name,nameEn:p.nameEn,weight:w,price,quantity:qty,image:p.image});
    $('qty-'+id).textContent='1';
    updateCartUI(); toast('àªªà«àª°à«‹àª¡àª•à«àªŸ àª•àª¾àª°à«àªŸàª®àª¾àª‚ àª‰àª®à«‡àª°àª¾àªˆ!');
  }
  function changeCartQuantity(id,weight,delta){
    const it=cart.find(i=>i.id===id && i.weight===weight); if(!it) return;
    it.quantity=Math.max(1, it.quantity+delta); updateCartUI();
  }
  function removeFromCart(index){ cart.splice(index,1); updateCartUI(); }
  function toggleCart(){ $('cart-drawer').classList.toggle('open'); }
  function updateCart(){ toggleCart(); }

  function updateCartUI(){
    const count=cart.reduce((s,i)=>s+i.quantity,0);
    const total=cart.reduce((s,i)=>s+i.price*i.quantity,0);
    $('cart-count').textContent=count; $('cart-total-header').textContent=money(total);
    const list=$('cart-items');
    if(!cart.length){ list.innerHTML='<p class="text-gray-500 text-center py-8">Your cart is empty</p>'; $('cart-total-block').classList.add('hidden'); $('checkout-form').classList.add('hidden'); return; }
    list.innerHTML = cart.map((item,idx)=>`
      <div class="flex items-center justify-between p-4 border-b">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-lg overflow-hidden bg-gray-100">
            <img src="assets/${item.image}" alt="${item.nameEn}" class="w-full h-full object-cover" />
          </div>
          <div><h4 class="font-semibold text-sm">${item.name}</h4><p class="text-xs text-gray-600">${item.weight}g - ${money(item.price)}</p></div>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="changeCartQuantity(${item.id},${item.weight},-1)" class="w-6 h-6 bg-gray-200 rounded-full text-sm">-</button>
          <span class="w-8 text-center text-sm">${item.quantity}</span>
          <button onclick="changeCartQuantity(${item.id},${item.weight},1)" class="w-6 h-6 bg-gray-200 rounded-full text-sm">+</button>
          <button onclick="removeFromCart(${idx})" class="text-red-500 ml-2">ğŸ—‘ï¸</button>
        </div>
      </div>
    `).join('');
    $('total-amount').textContent=money(total);
    $('cart-total-block').classList.remove('hidden');
    $('checkout-form').classList.remove('hidden');
  }

  /********** PAYMENT & WHATSAPP **********/
  // Enable confirm button when a screenshot is chosen
  $('payment-screenshot')?.addEventListener('change', (e)=>{
    uploadedScreenshotFile = e.target.files && e.target.files[0] ? e.target.files[0] : null;
    $('confirmPaymentBtn').disabled = !uploadedScreenshotFile;
  });

  function buildOrderText(){
    let total=0, lines='';
    cart.forEach(it=>{ const s=it.price*it.quantity; total+=s; lines += `â€¢ ${it.name} (${it.weight}g) Ã— ${it.quantity} = â‚¹${s}\\n`; });
    const name=$('customer-name')?.value||'';
    const mobile=$('customer-mobile')?.value||'';
    const address=$('customer-address')?.value||'';
    const pincode=$('customer-pincode')?.value||'';
    const landmark=$('customer-landmark')?.value||'';
    const notes=$('order-notes')?.value||'';
    let msg = `ğŸ›’ *NEW ORDER - PAPADSALE*%0A%0A`;
    msg += `ğŸ“¦ *Items:*%0A${encodeURIComponent(lines).replace(/%250A/g,'%0A')}`;
    msg += `%0AğŸ’° *Total:* â‚¹${total}%0A%0A`;
    if (name || mobile || address) {
      msg += `ğŸ‘¤ *Customer Details*%0A`;
      if (name) msg += `Name: ${encodeURIComponent(name)}%0A`;
      if (mobile) msg += `Mobile: ${encodeURIComponent(mobile)}%0A`;
      if (address) msg += `Address: ${encodeURIComponent(address)}%0A`;
      if (pincode) msg += `Pincode: ${encodeURIComponent(pincode)}%0A`;
      if (landmark) msg += `Landmark: ${encodeURIComponent(landmark)}%0A`;
    }
    if (notes) msg += `%0AğŸ“ Notes: ${encodeURIComponent(notes)}`;
    if (uploadedScreenshotURL) msg += `%0A%0AğŸ“¸ Payment screenshot: ${encodeURIComponent(uploadedScreenshotURL)}`;
    return msg + `%0A%0AğŸ™ Thank you!`;
  }

  async function confirmPaymentAndSend(){
    // Basic validations
    const need=['customer-name','customer-mobile','customer-address','customer-pincode'];
    for (const id of need){ const el=$(id); if(el && !el.value.trim()){ alert('Please fill in all required fields'); return; } }
    if (!uploadedScreenshotFile){ alert('Please upload the payment screenshot.'); return; }

    // Optional upload to your server to get a public URL (so you see the image in WhatsApp message)
    if (ADMIN_UPLOAD_ENDPOINT){
      try{
        const fd=new FormData(); fd.append('file', uploadedScreenshotFile);
        const r=await fetch(ADMIN_UPLOAD_ENDPOINT,{method:'POST',body:fd});
        const j=await r.json(); if (j && j.url) uploadedScreenshotURL=j.url;
      }catch(e){ console.warn('Upload failed, proceeding without URL.', e); }
    }

    // Send to Admin (your WhatsApp)
    const adminText = buildOrderText();
    const adminURL = `https://wa.me/${ADMIN_WHATSAPP}?text=${adminText}`;
    window.open(adminURL, '_blank');

    // Optional: send to customer
    if ($('send-summary-to-self')?.checked){
      const customerNum = ($('customer-mobile')?.value||'').replace(/\D/g,'');
      if (customerNum && customerNum.length===10){
        const summary = `ğŸ§¾ *Order Summary - PapadSale*%0A%0A` + buildOrderText();
        const customerURL = `https://wa.me/91${customerNum}?text=${summary}`;
        setTimeout(()=>window.open(customerURL,'_blank'), 600); // small offset
      }
    }

    // Clear cart & show success modal
    cart = [];
    updateCartUI();
    $('cart-drawer').classList.remove('open');
    $('success-modal').classList.add('show');
  }

  function sendMessage(e){
    e.preventDefault();
    const f=e.target;
    const name=f.querySelector('input[type="text"]').value;
    const phone=f.querySelector('input[type="tel"]').value;
    const message=f.querySelector('textarea').value;
    const url=`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(`àª¨àª®àª¸à«àª¤à«‡! àª®àª¾àª°à«àª‚ àª¨àª¾àª® ${name} àª›à«‡.\nàª«à«‹àª¨: ${phone}\nàª®à«‡àª¸à«‡àªœ: ${message}`)}`;
    window.open(url,'_blank'); f.reset(); toast('Message prepared on WhatsApp!');
  }

  // Click outside to close drawer / modal
  document.addEventListener('click', (e)=>{
    const drawer=$('cart-drawer'); const cartBtn=e.target.closest('button[onclick="toggleCart()"]');
    if (drawer && drawer.classList.contains('open') && !drawer.contains(e.target) && !cartBtn) drawer.classList.remove('open');
    const modal=$('success-modal'); if (e.target===modal) modal.classList.remove('show');
  });

  /********** INIT **********/
  document.addEventListener('DOMContentLoaded', ()=>{
    // Ensure the UPI link is correct
    const payLink = document.getElementById('payUPI'); if (payLink) payLink.href = UPI_LINK;
    renderProducts(); updateCartUI();
  });
  </script>
</body>
</html>
